---
title: "Data Collection progress"
format:
  dashboard:
    logo: "images/logo.png"
    orientation: columns
---

## Column{width="100%"}

```{r, loadpackages}
#| echo: false
#| include: false

library(tidyverse)
library(foreign)
library(dplyr)
library(readstata13)
library(ggplot2)
library(ggthemes)
library(plotly)
library(reactable)
library(leaflet)
library(terra)

```

# Tabela Progresu tuir Estatutu Intervista {height="50%"} 
```{r,echo=FALSE}
# setwd("D:/Quarto website/spotify-dashboard")

fcs <- read.dta13("data/dwelling_0503.dta")

targets_team <- data.frame(
  pr_06 = c("T01","T02","T03","T04","T05","T06","T07"),
  target_team = c(300,300,300,300,300,300,300))

fcs<- fcs %>%
  left_join(targets_team, by = "pr_06")

counts_team<-fcs %>%
  group_by(pr_06) %>%
  summarise(count = n())

coverage_team <- counts_team %>%
  left_join(targets_team, by = "pr_06") %>%
  mutate(`% Coverage by Team` = round((count / target_team) * 100, digits = 1))

coverage_team <- coverage_team %>% 
  rename( Ekipa = "pr_06")%>%
  rename( `Total uma-kain vizita` = "count") %>%
  rename(`Tarjetu amostra uma-kain`="target_team")

reactable(coverage_team)
```
# Grafiku Progressu Tuir Munisipiu {height="70%"}
```{r, computeindicators}

targets <- data.frame(
  dw_01 = c("Aileu", "Ainaro", "Atauro", "Baucau","Bobonaro","Covalima","Dili", "Ermera","LautÃ©m","Liquica", "Manatuto","Manufahi","Oecusse","Viqueque"),
  target = c(102, 120, 24, 204,192,174,258,228,150,114,126,108,138,162))
  
fcs<- fcs %>%
  left_join(targets, by = "dw_01")

counts<-fcs %>%
  group_by(dw_01) %>%
  summarise(count = n())

coverage <- counts %>%
  left_join(targets, by = "dw_01") %>%
  mutate(percentage_coverage = (count / target) * 100)


p<-ggplot(coverage, aes(fill = dw_01, x = dw_01, y =percentage_coverage)) +
              geom_bar(stat = "identity", position = "dodge") +
              labs(fill = "Municipality", x = "Municipality", y = "Percentage Coverage") +
              theme_minimal()

p<-p + guides(color = "legend") + theme(legend.position = "bottom")
ggplotly(p)
```

# Mapa {height="20%"}

```{r}
# Filter out rows with '99' in latitude or longitude
filtered_fcs <- fcs[!grepl('99', paste(fcs$pr_09, fcs$pr_10)), ]

# Create a leaflet map
map <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addCircleMarkers(
    lng = filtered_fcs$pr_10,
    lat = filtered_fcs$pr_09,
    color = 'blue',
    radius = 5,
    popup = paste("Ekipa:", filtered_fcs$pr_06, "  Kodigu Enumerador:", filtered_fcs$pr_03)
  )

# Print the map
map

```



